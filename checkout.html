<!-- goathousepizza.com/checkout.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>GoatHouse Pizza - Checkout</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/flatpickr.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/themes/dark.css">
    <link rel="icon" href="/images/favicon.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body, html {
            height: 100%;
            font-family: "Lato", sans-serif;
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>

<!-- THE WHOLE PAGE -->
<div class="large-bg-img">

    <div id="title" onclick="console.log(order_all);console.log(price_total);" class="bg-header"><b>CHECKOUT</b></div>

    <div class="checkout-content">

        <div id="calendar-box" class="checkout-content-box">
            <div>
                <span>Pickup:</span>
                <label for="date1"></label><input id="date1" placeholder="Select date and time..." data-input />
            </div>
            <p id="pickup-desc" style="margin:auto">Pickup at 221 W 2230 N #1, Provo, UT</p>
        </div>

        <div class="checkout-content-box">
            <div>

            </div>
        </div>

        <div id="finish" class="test-button" style="margin: 5px">TEST CALENDAR</div>
    </div>

</div>

<footer class="footer">
    <p>Copyright Â© 2022 <span>GoatHouse</span> Brick Oven Pizza - All Rights <span onclick="window.location.href='order.html'">Reserved</span>.<br><a href="index.html">Return Home</a></p>
</footer>

<script type="text/javascript" src="script.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/flatpickr.js"></script>
<script>
    // HANDLE THE RESIZING BASED ON SCREEN WIDTH
    resizeCheckout();
    window.onresize = function() {resizeCheckout()};
</script>
<script>
    // UNPACK ORDER OBJECT FROM order.html AND HANDLE PRICES
    let price_total;
    try {
        let order_all = new Order(JSON.parse(sessionStorage.order));
        let price_sc = 8;
        let price_dc = 15;
        let price_alc_p = 6;
        let price_alc_h = 3;
        let price_alc_d = 1;
        price_total = ((order_all.sc.length * price_sc) + (order_all.dc.length * price_dc) + (order_all.alc_p.length * price_alc_p) + (order_all.alc_h.length * price_alc_h) + (order_all.alc_d.length * price_alc_d));
    } catch (error) {
        console.log(error);
    }

</script>
<script>
    // HANDLE CALENDAR
    let datetime;
    // noinspection JSUnusedGlobalSymbols
    $("#date1").flatpickr({
        enableTime: true,
        minTime: "17:00",
        maxTime: "21:00",
        minuteIncrement: "15",
        dateFormat: "m-d-Y",
        minDate: "today",
        "disable": [
            function(date) {
                return (date.getDay() === 0 || date.getDay() === 1 || date.getDay() === 2 || date.getDay() === 3 || date.getDay() === 4);  // disable weekends
            }
        ],
        "locale": {
            "firstDayOfWeek": 0 // set start day of week to Sunday
        },
        onClose: function (dateTime) {
            datetime = dateTime;
        }
    });
</script>
<script>
    // HANDLE THE SUBMISSION OF THE ORDER
    document.getElementById("finish").addEventListener("click", function () {
        let dt1 = calculateDateTime1(datetime[0].toString());
        let dt2 = calculateDateTime2(dt1);
        //const event = createEvent(dt1, dt2, order_all.toStringList(), price_total);
        const testEvent = {
            "event": {
                "summary": "GoatHouse Pizza Order",
                "location": "221 W 2230 N, Provo, UT 84604",
                "description": "Name: Benny Blanco\nSMS: 678-999-8212\nOrder: 1x Pepperoni, 2x Mountain Dew\nPrice: $8",
                "start": {
                    "dateTime": dt1,
                    "timeZone": "America/Denver"
                },
                "end": {
                    "dateTime": dt2,
                    "timeZone": "America/Denver"
                }
            }
        }
        // at this point, the event object is correctly assembled

        // Send an HTTP POST request to my Azure account containing the trigger function, which has credentials and pushes the event to the calendar
        fetch('https://goathousepizza.azurewebsites.net/api/GHP-HttpTrigger', {
            method: 'POST',
            body: JSON.stringify(testEvent)
        });
    })
</script>

</body>
</html>

<!--
TODO: input for Name and Phone Number => add these to the event object
TODO: set up SMS API for text reminders?
-->