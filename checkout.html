<!-- goathousepizza.com/checkout.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>GoatHouse Pizza - Checkout</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/flatpickr.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/themes/dark.css">
    <link rel="icon" href="/images/favicon.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body, html {
            height: 100%;
            font-family: "Lato", sans-serif;
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>

<!-- THE WHOLE PAGE -->
<div class="large-bg-img">

    <div id="title" onclick="console.log(order_all);console.log(price_total);" class="bg-header"><b>CHECKOUT</b></div>

    <div id="calendar-box" class="calendar-box">
        <div>
            <span>Pickup:</span>
            <label for="date1"></label><input id="date1" placeholder="Select date and time..." data-input />
        </div>
        <p id="pickup-desc" style="margin:auto">Pickup at 221 W 2230 N #1, Provo, UT</p>
    </div>

</div>

<footer class="footer">
    <p>Copyright Â© 2022 <span id="finish">GoatHouse</span> Brick Oven Pizza - All Rights <span onclick="window.location.href='order.html'">Reserved</span>.<br><a href="index.html">Return Home</a></p>
</footer>

<script type="text/javascript" src="script.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/flatpickr.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="global.js"></script>
<script>
    // HANDLE THE RESIZING BASED ON SCREEN WIDTH
    resizeCheckout();
    window.onresize = function() {resizeCheckout()};
</script>
<script>
    // UNPACK ORDER OBJECT FROM order.html AND HANDLE PRICES
    let order_all = new Order(JSON.parse(sessionStorage.order));
    let price_sc = 8;
    let price_dc = 15;
    let price_alc_p = 6;
    let price_alc_h = 3;
    let price_alc_d = 1;
    let price_total = ((order_all.sc.length * price_sc) + (order_all.dc.length * price_dc) + (order_all.alc_p.length * price_alc_p) + (order_all.alc_h.length * price_alc_h) + (order_all.alc_d.length * price_alc_d));
</script>
<script>
    // HANDLE CALENDAR
    let datetime;
    // noinspection JSUnusedGlobalSymbols
    $("#date1").flatpickr({
        enableTime: true,
        minTime: "17:00",
        maxTime: "21:00",
        minuteIncrement: "15",
        dateFormat: "m-d-Y",
        minDate: "today",
        "disable": [
            function(date) {
                return (date.getDay() === 0 || date.getDay() === 1 || date.getDay() === 2 || date.getDay() === 3 || date.getDay() === 4);  // disable weekends
            }
        ],
        "locale": {
            "firstDayOfWeek": 0 // set start day of week to Sunday
        },
        onClose: function (dateTime) {
            datetime = dateTime;
        }
    });
</script>
<script type="module">
    // HANDLE THE SUBMISSION OF THE ORDER
    document.getElementById("finish").addEventListener("click", function () {
        let dt1 = calculateDateTime1(datetime[0].toString());
        let dt2 = calculateDateTime2(dt1);
        const event = createEvent(dt1, dt2, order_all.toStringList(), price_total);
        // at this point, the event is correctly assembled
        // add the event to calendar

        fetch('https://goathousepizza.azurewebsites.net/api/GHP-HttpTrigger', {
           body: JSON.stringify(event)
        });

        /*const GOOGLE_PRIVATE_KEY = gapiObj.private_key.trim();
        const GOOGLE_CLIENT_EMAIL = gapiObj.client_email;
        const GOOGLE_PROJECT_NUMBER = "668492908459";
        const GOOGLE_CALENDAR_ID = "prattnj@gmail.com";
        const SCOPES = 'https://www.googleapis.com/auth/calendar';
        const URL = "https://www.googleapis.com/calendar/v3/calendars/prattnj@gmail.com/events";*/


        // console.log(GOOGLE_PRIVATE_KEY);

        // OPTION B: JS fetch function to make API calls, however, its strings cannot contain the private key's newline characters
        /*fetch("URL", {
            method: "get",
            headers: {
                Authorization: "Bearer " + GOOGLE_PRIVATE_KEY
            }
        })
            .then(res => res.json())
            .then(json => console.log(json))
            .catch(error => console.log(error));*/

        // OPTION C: Importing a node.js module called googleapis, but Chrome returning an error with import statement syntax
        // this option likely not possible, as there must be a web server running to use modules

        // OPTION D: Using Google's gapi.client.request function (https://github.com/google/google-api-javascript-client/blob/master/docs/reference.md)
        /*gapi.client.request("URL", {

        })*/

        // OPTION E: JS Axios API (similar to fetch)
        /*axios.get(URL)
            .then(data => console.log(data))
            .catch(err => console.log(err));*/

        // OPTION F: Ajax
        /*const http = new XMLHttpRequest();
        http.open("GET", URL);
        http.send();
        http.onreadystatechange = (e) => {
            console.log(http.responseText)
        }*/

    })
</script>
<script>
    // OPTION A: Code provided by Google: https://github.com/google/google-api-javascript-client/blob/master/docs/start.md
    // Probably won't work, gapi.client.init only has property 'apiKey' which is different from what the calendar API needs for credentials
    /*function start() {
        // 2. Initialize the JavaScript client library.jwt
        gapi.client.init({
            'apiKey': gapiObj.private_key,
            // clientId and scope are optional if auth is not required.
            /!*'clientId': gapiObj.client_id,
            'scope': 'https://www.googleapis.com/auth/calendar',*!/
        }).then(function() {
            console.log("hello");
            // 3. Initialize and make the API request.
            return gapi.client.request({
                'path': 'https://www.googleapis.com/calendar/v3/calendars/prattnj@gmail.com',
            })
        }).then(function(response) {
            console.log("hello");
            console.log(response.result);
        }, function(reason) {
            console.log('Error: ' + reason.result.error.message);
        });
    }
    // 1. Load the JavaScript client library.
    gapi.load('client', start);*/

</script>

</body>
</html>